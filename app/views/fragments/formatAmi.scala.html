@(ami: AMI, id: String = java.util.UUID.randomUUID.toString)

@import datetime.DateUtils.{readableDateTime, getAgeColour, daysAgo}
@import prism.Recommendations

@defining(ami.creationDate.map(getAgeColour).getOrElse("red")) { colour =>
    <div class="ami-badge z-depth-1 grey lighten-3">
        <div class="ami-badge__icon-container">
            <img src="/assets/images/ami.png" alt="AMI" class="ami-badge__icon">
        </div>
        <div class="ami-badge__description center-align">
            <a class="modal-trigger" href="#modal-@id">
                @ami.imageId
            </a>
        </div>
        <div class="ami-badge__age @colour white-text center-align">
            @ami.creationDate match {
                case Some(date) => {
                    @daysAgo(date)
                    <i class="mdi-image-timelapse"></i>
                }
                case None => {
                    Ancient
                }
            }
        </div>
    </div>
}


<div id="modal-@id" class="modal ami-modal" xmlns="http://www.w3.org/1999/html">
    <div class="modal-footer ami-header white-text">
        @ami.upgrade.map { upgrade =>
        <div class="ami-header--title">
            <i class="mdi-action-backup"></i>
            Upgrade available
        </div>
        <a href="/ami?imageId=@upgrade.imageId" class="black-text modal-action waves-effect waves-white btn grey lighten-3">
            @upgrade.imageId
        </a>
        }.getOrElse {
            <div class="ami-header--title">
                <i class="mdi-action-done"></i>
                Latest version
            </div>
            <a href="#!" class="black-text modal-action modal-close waves-effect waves-white btn grey lighten-3">Close</a>
        }
    </div>
    <div class="modal-content">
        <table class="ami-details bordered">
            <tr>
                <th>Image ID</th>
                <td>@ami.imageId</td>
            </tr>
            <tr>
                <th>Creation date</th>
                <td>
                    @ami.creationDate match {
                        case Some(date) => {
                            @readableDateTime.print(date) -
                            <span class="@getAgeColour(date)-text">
                                @daysAgo(date) day@if(daysAgo(date) != 1){s} old
                            </span>
                        }
                        case None => {
                            <span class="red-text">Very old (no creation date available)</span>
                        }
                    }
                </td>
            </tr>
            @ami.name.map { name =>
                <tr>
                    <th>Name</th>
                    <td>@ami.name</td>
                </tr>
            }
            @ami.description.map { description =>
                <tr>
                    <th>Description</th>
                    <td>@ami.description</td>
                </tr>
            }
            @if(ami.tags.nonEmpty) {
                <tr>
                    <th>Tags</th>
                    <td>
                        <table class="tags">
                            <tbody>
                            @for( (key, value) <- ami.tags) {
                                <tr>
                                    <th>@key</th>
                                    <td>@value</td>
                                </tr>
                            }
                            </tbody>
                        </table>
                    </td>
                </tr>
            }
            <tr>
                <th>Region</th>
                <td>@ami.region</td>
            </tr>
            <tr>
                <th>Virtualization Type</th>
                <td>@ami.virtualizationType</td>
            </tr>
            <tr>
                <th>Architecture</th>
                <td>@ami.architecture</td>
            </tr>
            <tr>
                <th>Storage type</th>
                <td>@ami.rootDeviceType</td>
            </tr>
            <tr>
                <th>Owner</th>
                <td>@Recommendations.owner(ami)</td>
            </tr>
            <tr>
                <th>ARN</th>
                <td>@ami.arn</td>
            </tr>
        </table>
    </div>
    @ami.creationDate.map { date =>
        <div class="modal-footer @getAgeColour(date) lighten-3 black-text">
            <div class="ami-header--title">
                This AMI is <b>@daysAgo(date)</b> day@if(daysAgo(date) != 1){s} old
            </div>
        </div>
    }

</div>