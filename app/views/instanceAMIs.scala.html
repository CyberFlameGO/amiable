@(ssa: SSA, metrics: models.Metrics, amis: List[AMI], amiSSAs: List[(SSA, List[AMI])])

@import views.html.fragments.{ssaAmiForm, amiOverlay, printSSA, metricsHeader}

@main("Instance AMIs") {
    <div class="heading grey lighten-3">
        <div class="container">
            <div class="row">
                <div class="col m6">
                    <h1>AMIs in use</h1>
                </div>
                <div class="col m6 hide-on-small-only">
                    <p class="right-align"><a href="#search">[edit search]</a></p>
                    @printSSA(ssa, "*")
                </div>
            </div>
            @metricsHeader(metrics)
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="amis-list">
                @for(ami <- amis.sortBy(_.creationDate.map(_.getMillis))) {
                    <div class="amis-list__item">
                        @amiOverlay(ami)
                    </div>
                }
            </div>
        </div>
        <div class="row">
            <h2>AMI usage</h2>
            <div class="ssa-amis">
                @for((ssa, amis) <- amiSSAs) {
                    @if(ssa.isEmpty) {
                        @* show AMIs with empty SSAs in their own block (there are lots of them) *@
            </div>
        </div>

        <div class="row">
            @printSSA(ssa)
            <div class="ssa-amis">
                        @for(ami <- amis.sortBy(_.creationDate.map(_.getMillis))) {
                            <div class="ssa-amis__item">
                                @amiOverlay(ami)
                            </div>
                        }
        </div>
        <div class="row">
            <div class="ssa-amis">
                    } else {
                        <div class="ssa-amis__item">
                            <div class="card">
                                <div class="card-content">
                                    @printSSA(ssa)
                                    @for(ami <- amis.sortBy(_.creationDate.map(_.getMillis))) {
                                        @amiOverlay(ami)
                                    }
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
        <a name="search"></a>
        @ssaAmiForm(ssa)
    </div>
}()
